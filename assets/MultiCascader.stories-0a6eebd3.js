import{j as s}from"./jsx-runtime-ffb262ed.js";import{r as x}from"./index-76fb7be0.js";import{c as k}from"./index-a587463d.js";import{E as B}from"./EmptyTable-e7e0e5be.js";import"./_commonjsHelpers-de833af9.js";const z=u=>u?u.split(/,|，/).map(p=>p.trim()).filter(Boolean):[],j=(u,p)=>{const h=[];if(!u)return h;const n=v=>{h.push(v.value);const N=v.parent&&p.get(v.parent);N&&n(N)};return n(u),h},w=u=>{const p=[],h=n=>{n.children&&n.children.forEach(v=>{p.push(v.value),h(v)})};return h(u),p},S=({className:u,options:p,value:h,onChange:n,searchable:v=!0,themeColor:N="#1890ff",disabled:b,searchPlaceholder:P})=>{const[f,g]=x.useState([]),[E,R]=x.useState([]),[y,I]=x.useState([]),[C,A]=x.useState(new Map),o=x.useMemo(()=>{const e=new Map,l=(a,t,r)=>{t+=1,a.forEach(c=>{var i;c.depth=t,c.parent=r,e.set(c.value,c),(i=c.children)!=null&&i.length&&l(c.children,t,c.value)})};return l(p,0,null),e},[p]);x.useEffect(()=>{h&&g(h)},[h]),x.useEffect(()=>{if(!y.length)return;const e=new Map(y.map(l=>[l,[]]));o.forEach(l=>{[...e.keys()].forEach(a=>{var t;l.label.toLowerCase().includes(a.toLowerCase())&&((t=e.get(a))==null||t.push(l))})}),A(e)},[y]);const M=(e,l)=>{let a=[...f];const t=r=>{const c=r.parent&&o.get(r.parent);if(c&&c.children){const i=c.children.map(d=>d.value);i.every(d=>a.includes(d))&&(a=a.filter(d=>!i.includes(d)),a.push(c.value),t(c))}};if(l){const r=w(e);a=a.filter(c=>!r.includes(c)),a.push(e.value),t(e)}else{const r=a.indexOf(e.value);if(r!==-1)a.splice(r,1);else{const c=j(e,o),i=c.findIndex(m=>a.includes(m));i!==-1&&(c.slice(1,i+1).forEach(m=>{var d,T;(T=(d=o.get(m))==null?void 0:d.children)==null||T.forEach(K=>{a.push(K.value)})}),a=a.filter(m=>!c.slice(0,i+1).includes(m)))}}g(a),n==null||n(a)},D=e=>{const l=[...f],a=l.indexOf(e);a!==-1&&(l.splice(a,1),g(l),n==null||n(l))},_=e=>{var r;const l=j(e,o),a=f.some(c=>l.includes(c));let t=!1;if(!a){const c=w(e);t=f.some(i=>c.includes(i))}return s.jsxs("li",{title:e.label,className:k({"multi-cascader-menu-item":!0,"multi-cascader-menu-item-expand":!!((r=e.children)!=null&&r.length),"multi-cascader-menu-item-active":E.includes(e.value),"multi-cascader-menu-item-disabled":b||e.disabled}),onClick:()=>{if(b)return;const c=[...E];e.depth&&c.splice(e.depth-1,c.length,e.value),R(c)},children:[s.jsx("span",{className:k({"multi-cascader-checkbox":!0,"multi-cascader-checkbox-indeterminate":t,"multi-cascader-checkbox-checked":a,"multi-cascader-checkbox-disabled":b||e.disabled}),onClick:()=>{b||e.disabled||M(e,!a)},children:s.jsx("span",{className:"multi-cascader-checkbox-inner"})}),s.jsx("div",{className:"multi-cascader-menu-item-content",children:e.label}),s.jsx("div",{className:"multi-cascader-menu-item-expand-icon",children:s.jsx("span",{role:"icon",children:s.jsx("svg",{viewBox:"64 64 896 896",focusable:"false",width:"1em",height:"1em",fill:"currentColor",children:s.jsx("path",{d:"M765.7 486.8L314.9 134.7A7.97 7.97 0 00302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 000-50.4z"})})})})]},e.value)};return s.jsxs("div",{className:k("multi-cascader",u),style:{"--mca-theme-color":N},children:[v&&s.jsx("div",{className:"multi-cascader-search-bar",children:s.jsx("textarea",{className:"multi-cascader-search-bar-input",placeholder:P??"支持多项搜索，不同搜索词之间用中英文逗号隔开，按回车键搜索",onKeyDown:e=>{var t,r;const l=e.key==="Enter"||e.keyCode===13,a=(r=(t=e.target)==null?void 0:t.value)==null?void 0:r.trim();l&&e.preventDefault(),l&&a&&I(z(a))},onChange:e=>{var l,a;(a=(l=e.target)==null?void 0:l.value)!=null&&a.trim()||I([])}})}),s.jsxs("div",{className:"multi-cascader-body",children:[y.length?s.jsxs("div",{className:"multi-cascader-search-result",children:[s.jsxs("div",{className:"multi-cascader-search-result-header",children:[s.jsx("span",{children:"搜索词"}),s.jsx("span",{children:"搜索结果"})]}),s.jsx("div",{className:"multi-cascader-search-result-items",children:[...C.keys()].map(e=>{var l;return s.jsxs("div",{className:"multi-cascader-search-result-item",children:[s.jsx("div",{className:"multi-cascader-search-result-item-keyword",title:e,children:e}),s.jsx("div",{className:"multi-cascader-search-result-item-contents",children:(l=C.get(e))!=null&&l.length?C.get(e).map(a=>{const t=j(a,o).map(m=>{var d;return(d=o.get(m))==null?void 0:d.label}).reverse().join(" / ").replace(new RegExp(e,"ig"),"<span>$&</span>"),r=j(a,o),c=f.some(m=>r.includes(m));let i=!1;if(!c){const m=w(a);i=f.some(d=>m.includes(d))}return s.jsxs("div",{className:"multi-cascader-search-result-item-content",children:[s.jsx("span",{className:k({"multi-cascader-checkbox":!0,"multi-cascader-checkbox-indeterminate":i,"multi-cascader-checkbox-checked":c,"multi-cascader-checkbox-disabled":b||a.disabled}),onClick:()=>{b||a.disabled||M(a,!c)},children:s.jsx("span",{className:"multi-cascader-checkbox-inner"})}),s.jsx("div",{dangerouslySetInnerHTML:{__html:t},className:"multi-cascader-search-result-item-content-text"})]},a.value)}):"--"})]},e)})})]}):s.jsxs("div",{className:"multi-cascader-menus",children:[s.jsx("ul",{className:"multi-cascader-menu",children:p.map(e=>_(e))}),E.map(e=>{var a;const l=o.get(e);return(a=l==null?void 0:l.children)!=null&&a.length?s.jsx("ul",{className:"multi-cascader-menu",children:l.children.map(t=>_(t))},e):null})]}),s.jsxs("div",{className:"multi-cascader-result",children:[s.jsxs("div",{className:"multi-cascader-result-header",children:[s.jsxs("span",{children:["已选 ",f.length," 项"]}),s.jsx("span",{className:"multi-cascader-result-clear",onClick:()=>{g([]),n==null||n([])},children:"清空"})]}),s.jsx("div",{className:"multi-cascader-result-body",children:f.length?f.map(e=>s.jsxs("div",{className:"multi-cascader-result-item",children:[j(o.get(e),o).map(l=>{var a;return(a=o.get(l))==null?void 0:a.label}).reverse().join(" / "),s.jsx("span",{className:"multi-cascader-result-item-close",onClick:()=>D(e),children:"+"})]},e)):s.jsx(B,{emptyText:"暂未选择",style:{marginTop:60}})})]})]})]})};try{S.displayName="MultiCascader",S.__docgenInfo={description:"",displayName:"MultiCascader",props:{className:{defaultValue:null,description:"component class name",name:"className",required:!1,type:{name:"string"}},options:{defaultValue:null,description:"Options of component",name:"options",required:!0,type:{name:"optionType[]"}},value:{defaultValue:null,description:"Selected value",name:"value",required:!1,type:{name:"valueType[]"}},onChange:{defaultValue:null,description:"Callback function called when the value changes",name:"onChange",required:!1,type:{name:"((value: valueType[]) => void)"}},searchable:{defaultValue:{value:"true"},description:"Is it possible to search",name:"searchable",required:!1,type:{name:"boolean"}},themeColor:{defaultValue:{value:"#1890ff"},description:"Theme color",name:"themeColor",required:!1,type:{name:"string"}},disabled:{defaultValue:null,description:"disabled status",name:"disabled",required:!1,type:{name:"boolean"}},searchPlaceholder:{defaultValue:null,description:"Search input placeholder",name:"searchPlaceholder",required:!1,type:{name:"string"}}}}}catch{}const Q={title:"Components/MultiCascader",component:S,parameters:{layout:"centered"},tags:["autodocs"],argTypes:{}},V={args:{options:[{label:"北京",value:1},{label:"江西",value:2,children:[{label:"南昌",value:21,children:[{label:"南昌县",value:211},{label:"安义县",value:212}]},{label:"九江",value:22}]}],value:[],onChange:u=>{console.log(u)}}};var q,L,O;V.parameters={...V.parameters,docs:{...(q=V.parameters)==null?void 0:q.docs,source:{originalSource:`{
  args: {
    options: [{
      label: '北京',
      value: 1
    }, {
      label: '江西',
      value: 2,
      children: [{
        label: '南昌',
        value: 21,
        children: [{
          label: '南昌县',
          value: 211
        }, {
          label: '安义县',
          value: 212
        }]
      }, {
        label: '九江',
        value: 22
      }]
    }],
    value: [],
    onChange: v => {
      console.log(v);
    }
  }
}`,...(O=(L=V.parameters)==null?void 0:L.docs)==null?void 0:O.source}}};const U=["Primary"];export{V as Primary,U as __namedExportsOrder,Q as default};
//# sourceMappingURL=MultiCascader.stories-0a6eebd3.js.map
